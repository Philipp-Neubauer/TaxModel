---
title: "size plots"
output: pdf_document
---
```{r pre,echo=F,message=F,warning=F}

knitr::opts_chunk$set(warning=F,message=F)
require("ggplot2")
require("dplyr")

```

```{r tax sd, fig.cap="Proportion of variance attributed to each taxonomic level in the analysis."}

load("tax_model_runs.Rdata")

sds <- list()
sds[[1]] <- JM_rfx$BUGSoutput$sims.list[grepl('sd',names(JM_rfx$BUGSoutput$sims.list))]
sds[[2]] <- JM_rfx_h$BUGSoutput$sims.list[grepl('sd',names(JM_rfx_h$BUGSoutput$sims.list))]
sds[[3]] <- JM$BUGSoutput$sims.list[grepl('sd',names(JM$BUGSoutput$sims.list))]

ssd <- plyr::llply(sds,function(x) apply(as.data.frame(x),1,function(z) z/sum(z)))

msd <- reshape2::melt(ssd)

msd <- msd %>% 
  mutate(Factor = do.call('rbind',strsplit(as.character(Var1),'sd.'))[,2]) %>%
  group_by(L1,Factor) %>%
  summarise(means = median(value),
            q1 = quantile(value,0.025),
            q11 = quantile(value,0.25),
            q33 = quantile(value,0.75),
            q3 = quantile(value,0.975))
  
msd$Factor <- rep(c('Family','Genus','Order','Species'),3)
msd$L1 <- rep(c('rfx','rfx_h','rfx_ht'),each=4)
colnames(msd)[1] <- 'model'

msd$Factor <- factor(msd$Factor,levels = c('Species','Genus','Family','Order'))

dw=0.75
ggplot(msd) + 
  geom_point(aes(x=Factor, y=means, col=model), size=4, position=position_dodge(width=dw)) + 
  geom_linerange(aes(x=Factor, y=means,ymin=q1,ymax=q3,col=model),size=1,position=position_dodge(width=dw)) + 
  geom_linerange(aes(x=Factor, y=means,ymin=q11,ymax=q33,col=model),size=2,position=position_dodge(width=dw)) + 
  theme_classic() + 
  coord_flip() + 
  #ylab(expression(Finite~population~variance~(log[10]~PPMR))) + 
  ylab('Proportion of variance')
```
